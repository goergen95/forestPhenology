---
output: 
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    df_print: kable
    latex_engine: pdflatex
    fig_caption: true
bibliography: ForestPhenology.bib
csl: elsevier-harvard.csl
title: "UAV imagery based tree species classification in the Marburg OpenForest"
author: 
- Darius A. Görgen
- Tobias Koch
- Marvin Müsgen
- Eike Schott
date: "`r format(Sys.time(), '%B %d, %Y')`"

abstract: "The monitoring of forests environments is of crucial importance since they serve as natural habitats and constitute a main source of biological diversity. Yet, it is very costly and labor intensive to monitor forests by traditional means. Recently, there have been several attempts to use UAV-borne imagery in forest monitoring since these images can be obtained at low cost and can come with both, high spatial and temporal resolution which enable scientists and practitioners to comprehensively monitor forest environments. Tree species identification is primary interest, since the identification of species allows to draw conclusions about the structure and biodiversity in given areas of a forest. When using simple RGB images, species classification still remains a challenge. In this paper we present our results of an experiment exploring the influence of spatial resolution of RGB imagery, artificially derived vegetation indices as well as seasonal parameters on the accuracy of tree species classification within the Marburg OpenForest. We used a resolution of 5 cm, 10 cm, 15 cm, and 25 cm in a forwar-feature-selection based on the RandomForest classification algorithm. Additionally we tested the obtained accuracy when only mono-temporal or multi-temporal variables are included as well as both types of variables. Our results show that ..."

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tmap)
library(caret)
library(raster)
```

# Introduction

# Data and Method

The UAV imageries were obtained through the use of a GoPro x.x and an overpass over the region
in approximatley 40 meters height. Orthorectified photos were created by the use of the
AgiSoft OpenSource Software. In total we worked on 6 images which were obtained between the end of April to 
the end of June. In the mitlatitudes of central Europe these are the months of vegetational
peak of mixed forests. We calculated a selection of RGB-based vegetational indices for each
of the images as well as seasonal statistics which describe the development of these indices
in the course of the vegetation period.

```{r dates-table, echo=F, tab.cap="Days of UAV overpass.",}
dates = unique(readRDS("../../data/resampled/dates.rds"))
dates = as.Date(dates, format = "%Y_%m_%d" )
dates = data.frame(Dates=dates)
knitr::kable(dates, align="l", caption = "Dates of the UAV overpasses.",)

```
```{r cv_visualization, warning=F,message=F,echo=F}
trees = rgdal::readOGR("../../data/trees_buffer.shp" )
trees@data$polID = seq(nrow(trees@data))
set.seed(1899)
index = caret::createDataPartition(y = trees@data$polID, p = .70, list = FALSE)
pred = trees@data[-index, ]
ind = CAST::CreateSpacetimeFolds(pred, spacevar = "polID", k = 5)

trees@data$train[index] = 0
trees@data$train[-index] = 1

trees@data$cv1[trees$id %in%pred$id[ind$index[[1]]]] = 1
trees@data$cv1[trees$id %in%pred$id[ind$indexOut[[1]]]] = 0

trees@data$cv2[trees$id %in%pred$id[ind$index[[2]]]] = 1
trees@data$cv2[trees$id %in%pred$id[ind$indexOut[[2]]]] = 0

trees@data$cv3[trees$id %in%pred$id[ind$index[[3]]]] = 1
trees@data$cv3[trees$id %in%pred$id[ind$indexOut[[3]]]] = 0

trees@data$cv4[trees$id %in%pred$id[ind$index[[4]]]] = 1
trees@data$cv4[trees$id %in%pred$id[ind$indexOut[[4]]]] = 0

trees@data$cv5[trees$id %in%pred$id[ind$index[[5]]]] = 1
trees@data$cv5[trees$id %in%pred$id[ind$indexOut[[5]]]] = 0

rgbimage = raster::stack("../../data/resampled/res25.tif")
rgb_names = readRDS("../../data/resampled/names_RGB_stack.rds")
names(rgbimage) = rgb_names 

rgbimage = rgbimage[[13:15]]


tm_shape(rgbimage)+
  tm_rgb()+
  tm_shape(trees)+
  tm_fill(col = "train", palette = "RdBu")


tm_shape(rgbimage)+
  tm_rgb()+
  tm_shape(trees)+
  tm_polygons(c("cv1","cv2","cv3","cv4","cv5"))

```

# Results


# Sources
Example citation [@Ulsig2017a].


